extends layout

block content
  #containerDiv
    img.backImage(src="/images/transhuman-peacock-dancer.jpg") 
    #navBar
      a#cancelButton(href="/wizard/cancel")
        button.leftNavButton Cancel
      p Homeland
    #contentArea
      div.dataEntry
        p.explanatoryHeading
          | Choose the location of your character's birth. Birth location determines
          | possible genetic and cybernetic modification available.
        form(action="/wizard/choosehomeland", method="POST")
          fieldset
            p
              label(for="world") World:
              div.styledSelect
                select(name="world", id="world")
            p
              label(for="locale") Locale: 
              div.styledSelect
                select(name="locale", id="locale")
            p
              button.rightForm Next

  script
    $(document).ready( function() {
        function updateLocales() {
            $("#world option:selected").each(function() {
                // only one should be here
                $('#locale').empty();
                socket.emit('locales', this.value, function(data) {
                    for( i=0;i<data.length;i++) {
                        opt = $("<option></option>")
                        .attr("value",data[i].name)
                        .text(data[i].name)
                        .attr("selected",data[i].name==#{defaultHomeland});
                        $('#locale').append(opt);
                    }
                });
            });
        }
        
        var socket = io.connect('http://localhost');
        socket.on('connected', function () {
            socket.emit('worlds', function (data) {
                for( var i=0;i<data.length;i++) {
                    var opt = $("<option></option>")
                        .attr("value",data[i].name)
                        .text(data[i].name)
                        .attr("selected",data[i].name==#{defaultWorld});
                    $('#world').append(opt);
                }

                updateLocales();
            });
        });
        
        $('#world').change(function() {updateLocales();});
    });