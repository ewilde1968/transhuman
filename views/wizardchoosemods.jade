extends layout

block content
  script
    var modDict = {};
    var ownedDict = {};
    var prohibitedDict = {};

  #containerDiv
    img.backImage(src="/images/transhuman-peacock-dancer.jpg") 
    #navBar
      a#cancelButton(href="/wizard/cancel")
        button.leftNavButton Cancel
      p Modifications
    #contentArea
      div.dataEntry
        p.explanatoryHeading
          | Genetic modifications and technological augmentations
          | provide superhuman powers.
        form(action="/wizard/choosemods", method="POST")
          fieldset
            p#humanTot Humanity #{character.humanity}
            p#credTot Credits #{character.credits}
            br
            each modType in mods
              h1.centered #{modType[0].type}
                ul.optionList
                  each mod in modType
                    li.optionItem(id="#{mod.name}")
                      detailsURL = '/wizard/choosemods/' + mod.name
                      a(href=detailsURL)
                        div
                          p.optionLabel #{mod.name}
                          descStr = 'Hum ' + mod.humanCost + ' / Cr ' + mod.creditCost
                          p.optionDesc #{descStr}
                      script
                          var newObj = {lock:0,
                              selected:false,
                              name:"#{mod.name}",
                              prohibited:[],
                              humanCost:#{mod.humanCost},
                              creditCost:#{mod.creditCost}
                              };
                          modDict["#{mod.name}"] = newObj;
                      each pObj in mod.prohibited
                        script
                            newObj.prohibited.push("#{pObj}");
            p
              button.rightForm(id="next") Next

  each modObj in character.mods
    script
      ownedDict[ '#{modObj.name}'] = '#{modObj.name}';
    each prohibitedName in modObj.prohibited
      script
        prohibitedDict[ '#{prohibitedName}'] = true;

  script
    $(document).ready( function() {
        var getModDictEntry = function(obj) {
            var mStr = obj.attr("id");
            return modDict[mStr];
        };

        var checkCost = function(m) {
            if( m.humanCost > #{character.humanity} || m.creditCost > #{character.credits})
                return false;
            return true;
        };
        
        var checkProhibited = function(m) {
            if( prohibitedDict[ m.name])
              return true;
            
            return false;
        };

        // initialize each item
        $(".optionItem").each( function() {
            var m = getModDictEntry($(this));
            if( ownedDict[m.name] != null)
              $(this).addClass('selectedItem');
            else {
              if( !checkCost(m))
                $(this).addClass('tooExpensiveItem');
              if( checkProhibited(m))
                $(this).addClass('prohibitedItem');
            }
        });
    });